"use strict";(self.webpackChunksleact_front=self.webpackChunksleact_front||[]).push([[808],{808:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var l=n(7294),a=n(2309),r=n(2545),c=n(8678),o=n(8667),s=n(5977),u=n(2951),i=n(5723),d=n(3564),h=n(9498),p=n(9669),m=n.n(p),v=n(9250);const f=()=>{var e,t;const{workspace:n,channel:p}=(0,s.UO)(),[f,g]=(0,l.useState)(!1),k=(0,l.useRef)(null),[_]=(0,u.Z)(n),{data:b}=(0,i.ZP)("/api/users",d.Z),{data:C}=(0,i.ZP)(`/api/workspaces/${n}/channels/${p}`,d.Z),{data:E,mutate:Z,revalidate:w,setSize:$}=(0,i.g_)((e=>`/api/workspaces/${n}/channels/${p}/chats?perPage=20&page=${e+1}`),d.Z),{data:S}=(0,i.ZP)(b?`/api/workspaces/${n}/channels/${p}/members`:null,d.Z),T=0===(null==E||null===(e=E[0])||void 0===e?void 0:e.length)||E&&(null===(t=E[E.length-1])||void 0===t?void 0:t.length)<20||!1,[I,P,U]=(0,c.Z)(""),B=(0,l.useCallback)((e=>{if(e.preventDefault(),null!=I&&I.trim()&&E&&C){const e=I;Z((t=>{var n;return null==t||t[0].unshift({id:((null===(n=E[0][0])||void 0===n?void 0:n.id)||0)+1,content:e,UserId:b.id,User:b,ChannelId:C.id,Channel:C,createdAt:new Date}),t}),!1).then((()=>{var e;U(""),k.current&&(null===(e=k.current)||void 0===e||e.scrollToBottom())})),m().post(`/api/workspaces/${n}/channels/${p}/chats`,{content:I}).then((()=>{w()})).catch((e=>console.dir(e)))}U("")}),[I,E,b,C,n,p]);(0,l.useEffect)((()=>{var e;1===(null==E?void 0:E.length)&&(null===(e=k.current)||void 0===e||e.scrollToBottom())}),[E]);const H=(0,l.useCallback)((e=>{e.Channel.name===p&&e.UserId!==b.id&&Z((t=>(null==t||t[0].unshift(e),t)),!1).then((()=>{k.current&&k.current.getScrollHeight()<k.current.getClientHeight()+k.current.getScrollTop()+150&&setTimeout((()=>{var e;null===(e=k.current)||void 0===e||e.scrollToBottom()}),50)}))}),[p,Z,b]);(0,l.useEffect)((()=>(null==_||_.on("dm",H),()=>{null==_||_.off("dm",H)})),[_,b]);const N=(0,l.useCallback)((()=>{g(!0)}),[]),R=(0,l.useCallback)((()=>{g(!1)}),[]);if(!C||!b)return null;const y=(0,o.Z)(E?E.flat().reverse():[]);return l.createElement(h.u.Container,null,l.createElement(h.u.Header,null,l.createElement("span",null,"#",p),l.createElement("div",{className:"header-right"},l.createElement("span",null,null==S?void 0:S.length),l.createElement("button",{onClick:N,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},l.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),l.createElement(r.Z,{chatSections:y,scrollRef:k,setSize:$,isReachingEnd:T}),l.createElement(a.Z,{chat:I,onChangechat:P,onSubmitForm:B}),l.createElement(v.Z,{show:f,onCloseModal:R,setShowInviteModal:g}))}}}]);