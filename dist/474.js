"use strict";(self.webpackChunksleact_front=self.webpackChunksleact_front||[]).push([[474],{3474:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var l=n(7294),r=n(6182),a=n.n(r),c=n(5723),u=n(5977),o=n(9669),s=n.n(o),i=n(3564),d=n(9498),m=n(2309),v=n(2545),h=n(8678),f=n(8667),p=n(2951);const g=()=>{var e,t;const n=(0,l.useRef)(null),{workspace:r,id:o}=(0,u.UO)(),[g]=(0,p.Z)(r),{data:k}=(0,c.ZP)(`/api/workspaces/${r}/users/${o}`,i.Z,{dedupingInterval:1e3}),{data:Z}=(0,c.ZP)("/api/users",i.Z),{data:E,mutate:S,revalidate:b,setSize:w}=(0,c.g_)((e=>`/api/workspaces/${r}/dms/${o}/chats?perPage=20&page=${e+1}`),i.Z),C=0===(null==E||null===(e=E[0])||void 0===e?void 0:e.length)||E&&(null===(t=E[E.length-1])||void 0===t?void 0:t.length)<20||!1,[$,R,T]=(0,h.Z)(""),I=(0,l.useCallback)((e=>{if(e.preventDefault(),null!=$&&$.trim()&&E){const e=$;S((t=>{var n;return null==t||t[0].unshift({id:((null===(n=E[0][0])||void 0===n?void 0:n.id)||0)+1,content:e,SenderId:Z.id,Sender:Z,ReceiverId:k.id,Receiver:k,createdAt:new Date}),t}),!1).then((()=>{var e;T(""),n.current&&(null===(e=n.current)||void 0===e||e.scrollToBottom())})),s().post(`/api/workspaces/${r}/dms/${o}/chats`,{content:$}).catch((e=>console.dir(e)))}T("")}),[$,E,Z,k,r,o]);(0,l.useEffect)((()=>{var e;1===(null==E?void 0:E.length)&&(null===(e=n.current)||void 0===e||e.scrollToBottom())}),[E]);const B=(0,l.useCallback)((e=>{e.SenderId===Number(o)&&Z.id!==Number(o)&&S((t=>(null==t||t[0].unshift(e),t)),!1).then((()=>{n.current&&n.current.getScrollHeight()<n.current.getClientHeight()+n.current.getScrollTop()+150&&setTimeout((()=>{var e;null===(e=n.current)||void 0===e||e.scrollToBottom()}),50)}))}),[o,S,Z]);if((0,l.useEffect)((()=>(null==g||g.on("dm",B),()=>{null==g||g.off("dm",B)})),[g,o,Z]),!k||!Z)return null;const H=(0,f.Z)(E?E.flat().reverse():[]);return l.createElement(d.u.Container,null,l.createElement(d.u.Header,null,l.createElement("img",{src:a().url(k.email,{s:"24px",d:"retro"}),alt:k.nickname}),l.createElement("span",null,k.nickname)),l.createElement(v.Z,{chatSections:H,scrollRef:n,setSize:w,isReachingEnd:C}),l.createElement(m.Z,{chat:$,onChangechat:R,onSubmitForm:I}))}}}]);